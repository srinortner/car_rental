DROP TABLE IF EXISTS vehicle_license_requirement;
DROP TABLE IF EXISTS vehicle_booking;
DROP TABLE IF EXISTS vehicle;
DROP TABLE IF EXISTS booking;

DROP SEQUENCE IF EXISTS invoice_number;

CREATE TABLE IF NOT EXISTS vehicle (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(288) NOT NULL,
  buildyear YEAR NOT NULL,
  description TEXT,
  seats NUMERIC(2,0),
  licenseplate VARCHAR(7),
  type VARCHAR(6) NOT NULL CHECK(type IN ('ENGINE', 'MUSCLE')),
  power NUMERIC(7,3),
  hourlyrate NUMERIC(5,0),
  picture VARCHAR(100),
  createtime TIMESTAMP NOT NULL,
  uuid_for_editing VARCHAR(288) NOT NULL,
  edittime TIMESTAMP NOT NULL,
  deleted BOOLEAN DEFAULT FALSE,
);

INSERT INTO vehicle
SELECT * FROM (
SELECT * FROM vehicle WHERE FALSE

UNION SELECT 1, 'Seat', 2001, 'needs B license', 4, 'AB12345','ENGINE', 100, 120, NULL, '2018-10-01 10:22:00', 'cardefault1','2018-10-01 10:22:00', False
UNION SELECT 2, 'Honda', 2005, 'needs C license', 3, 'AB22334', 'ENGINE', 100, 120, NULL, '2018-10-01 10:23:00', 'cardefault2','2018-10-01 10:23:00', False
UNION SELECT 3, 'Mountainbike', 2011, 'needs no license', 1, NULL, 'MUSCLE', 20, 100, NULL, '2018-10-01 10:24:00', 'bikedefault1','2018-10-01 10:24:00', false
UNION SELECT 4, 'Motorbike', 2012, 'needs A license', 1, 'AB12333', 'ENGINE',44,100,NULL,'2018-10-01 10:24:00', 'motorbikedefault1','2018-10-01 10:24:00', false
UNION SELECT 5, 'KTM', 2008, 'needs A or B license', 1, 'AB22551', 'ENGINE', 45, 200, NULL, '2018-10-01 10:24:00', 'motorbikedefault2','2018-10-01 10:24:00', false
UNION SELECT 6, 'Fiat', 2002, 'needs B license', 6, 'AB12332', 'ENGINE', 50, 200, NULL, '2018-10-01 10:24:00', 'cardefault3','2018-10-01 10:24:00', true
UNION SELECT 7, 'Fiat', 2002, 'needs B license, edited', 6, 'AB12332', 'ENGINE', 60, 200, NULL, '2018-10-01 10:24:00', 'cardefault3','2018-10-05 10:24:00', false
UNION SELECT 8, 'Segway', 2016, 'needs no license', 1, NULL, 'MUSCLE',20, 80, NULL, '2018-10-01 10:24:00', 'motorbikedefault2','2018-10-01 10:24:00', false
UNION SELECT 9, 'Fiat Ulysse', 2000, 'needs B or C license', 6, 'VB12345', 'ENGINE', 65, 250, NULL, '2018-10-01 10:24:00', 'cardefault4','2018-10-05 10:24:00', false
UNION SELECT 10, 'Opel', 1999, 'is deleted', 4, 'AB11122', 'ENGINE', 50, 140,NULL, '2018-10-01 10:24:00', 'cardefault5','2018-10-05 10:24:00', true
UNION SELECT 11, 'Audi', 2014, 'needs B license', 3, 'AB22344', 'ENGINE', 200, 300, NULL, '2018-10-01 10:24:00', 'cardefault6','2018-10-05 10:24:00', false

);

CREATE TABLE vehicle_license_requirement (
  vehicle_id BIGINT NOT NULL,
  license VARCHAR(1) CHECK(license IN ('A', 'B', 'C')),
  FOREIGN KEY (vehicle_id) references vehicle(id),
);

INSERT INTO vehicle_license_requirement
SELECT * FROM (
SELECT * FROM vehicle_license_requirement WHERE FALSE

UNION SELECT 1, 'B'
UNION SELECT 2, 'C'
UNION SELECT 4, 'A'
UNION SELECT 5, 'A'
UNION SELECT 5, 'B'
UNION SELECT 6, 'B'
UNION SELECT 7, 'B'
UNION SELECT 9, 'B'
UNION SELECT 9, 'C'
UNION SELECT 10, 'B'
UNION SELECT 11, 'B'

);

CREATE SEQUENCE IF NOT EXISTS invoice_number START WITH 1 INCREMENT BY 1;

CREATE TABLE IF NOT EXISTS booking (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(288) NOT NULL,
  paymenttype VARCHAR(10) NOT NULL CHECK (paymenttype IN ('IBAN','CREDITCARD')),
  paymentnumber VARCHAR(288) NOT NULL,
  startdate TIMESTAMP NOT NULL,
  enddate TIMESTAMP NOT NULL,
  vehicles VARCHAR(288) NOT NULL,
  total_price NUMERIC(100,0) NOT NULL,
  type VARCHAR(8) NOT NULL CHECK(type IN ('BOOKED', 'PAID', 'CANCELED')),
  createtime TIMESTAMP NOT NULL,
  paidtime TIMESTAMP DEFAULT NULL,
  ivoice_number_booking INTEGER DEFAULT NULL

);

INSERT INTO booking
SELECT * FROM (
SELECT * FROM booking WHERE FALSE

UNION SELECT 1, 'Ash Ketchum','CREDITCARD', '4532642579652817', '2018-04-04 10:22:00', '2018-04-05 10:25:00', '[Seat ]', 2000, 'BOOKED', '2018-10-01 10:29:00', NULL, NULL
UNION SELECT 2, 'Misty', 'CREDITCARD', '4532642579652817', '2018-10-06 10:22:00', '2018-10-07 10:22:00', '[Seat ]', 2000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 3, 'Gary Oak', 'CREDITCARD', '4532642579652817', '2018-10-06 10:22:00', '2018-10-07 10:22:00', '[KTM, Fiat ]', 2000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 4, 'Professor Samuel Oak', 'CREDITCARD', '4532642579652817', '2018-05-06 10:22:00', '2018-05-07 10:22:00', '[Segway ]', 1000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 5, 'Jessie',  'CREDITCARD', '4532642579652817', '2018-05-06 10:22:00', '2018-05-07 10:22:00', '[Motorbike ]', 1000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 6, 'James',  'CREDITCARD', '4532642579652817', '2018-07-06 10:22:00', '2018-07-07 10:22:00', '[Mountainbike, Motorbike, Segway ]', 3000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 7, 'Nurse Joy', 'CREDITCARD', '4532642579652817', '2018-07-10 10:22:00', '2018-07-21 10:22:00', '[Audi ]', 5000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 8, 'Officer Jenny', 'CREDITCARD', '4532642579652817', '2018-07-25 10:22:00', '2018-07-28 10:22:00', '[Motorbike ]', 2000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 9, 'Tracey Sketchit', 'CREDITCARD', '4532642579652817', '2018-07-25 10:22:00', '2018-07-28 10:22:00', '[Opel ]', 1000, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
UNION SELECT 10, 'May', 'CREDITCARD', '4532642579652817', '2018-04-25 10:22:00', '2018-04-28 10:22:00', '[Mountainbike ]', 500, 'BOOKED', '2018-10-01 10:22:00', NULL, NULL
);

CREATE TABLE IF NOT EXISTS vehicle_booking (
  vehicle_id BIGINT NOT NULL,
  booking_id BIGINT NOT NULL,
  FOREIGN KEY (vehicle_id) references vehicle(id),
  FOREIGN KEY (booking_id) references booking(id),
  license VARCHAR(1) CHECK(license IN ('A', 'B', 'C')),
  license_number TEXT,
  license_date DATE,
);

INSERT INTO vehicle_booking
SELECT * FROM (
SELECT * FROM vehicle_booking WHERE FALSE

UNION SELECT 1, 1, 'B', 12345, '2015-10-04'
UNION SELECT 1, 2, 'C',12344, '2014-10-04'
UNION SELECT 1, 2, 'B', 12345, '2015-10-04'
UNION SELECT 5, 3, 'A', 12345, '2014-10-10'
UNION SELECT 5, 3, 'B', 12345, '2014-10-10'
UNION SELECT 6, 3, 'B', 12345, '2014-10-10'
UNION SELECT 8, 4, NULL, NULL, null
UNION SELECT 4, 5, 'A', 12345, '2014-10-10'
UNION SELECT 3, 6, NULL, NULL, null
UNION SELECT 4, 6, 'A', 12345, '2014-10-10'
UNION SELECT 5, 6, NULL, NULL, NULL
UNION SELECT 11, 7, 'B', 12345, '2014-10-10'
UNION SELECT 4, 8, 'A', 12345, '2014-10-10'
UNION SELECT 10, 9, 'B', 12345, '2014-10-10'
UNION SELECT 3, 10, NULL, NULL, NULL


);